summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO ))
colnames(dt)[1] <- feature
table<- formattable(dt,
align=c('l','r', 'r','r', 'r'),
list(
Freq = percent,
nb_lignes= accounting,
EXPO = accounting,
pct_EXPO = percent
)
)
fig1<- plot_obs_2(df, feature, use_year = F)
fig2<- plot_obs_2(df, feature, use_year = T)
return(list(table=table, fig=fig1, figyr=fig2))
}
res<-resume(mrh_train, 'VALEUR_DES_BIENS')
res$table
res$fig
res$figyr
plot_obs_2<-function(df,feature,use_year=T) {
if (use_year) {
dt <-df %>%
group_by(df[[feature]], ANNEE, .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO)) %>%
rename(feat = 'df[[feature]]')
} else {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO)) %>%
rename(feat = 'df[[feature]]')
}
fig <-plot_ly()
fig <- fig %>% layout(title = paste0('Fréquence de sinistres par ', feature),
xaxis = list(title = feature),
yaxis = list(side = 'left', title = 'Exposition', showgrid = FALSE, zeroline = FALSE),
yaxis2 = list(side = 'right', overlaying = "y", title = 'Fréquence', showgrid = FALSE, zeroline = FALSE))
if (use_year) {
for (year in unique(dt$ANNEE)) {
dt_temp <- dt %>% filter(ANNEE==year)
fig <- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$EXPO, type = 'bar', name = paste0('Exposition_', year),
hovertemplate = 'Expo: %{y:.0f}<br>'
)
fig<- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$Freq, type = 'scatter', mode = 'lines', yaxis = 'y2', name= paste0('Fréquence_', year),
hovertemplate = 'Freq: %{y:.2%}<br>'
)
}
} else {
dt_temp <- dt
fig <- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$EXPO, type = 'bar', name = 'Exposition',
hovertemplate = 'Expo: %{y:.0f}<br>'
)
fig<- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$Freq, type = 'scatter', mode = 'lines', yaxis = 'y2', name= 'Fréquence',
hovertemplate = 'Freq: %{y:.2%}<br>'
)
}
return(fig)
}
resume <- function(df, feature) {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO ))
colnames(dt)[1] <- feature
table<- formattable(dt,
align=c('l','r', 'r','r', 'r'),
list(
Freq = percent,
nb_lignes= accounting,
EXPO = accounting,
pct_EXPO = percent
)
)
fig1<- plot_obs_2(df, feature, use_year = F)
fig2<- plot_obs_2(df, feature, use_year = T)
return(list(table=table, fig=fig1, figyr=fig2))
}
res<-resume(mrh_train, 'NB_PIECES')
res$table
res$fig
res$figyr
resume <- function(df, feature) {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO ))
colnames(dt)[1] <- feature
table<- formattable(dt,
align=c('l','r', 'r','r', 'r'),
list(
Freq = percent,
nb_lignes= accounting,
EXPO = accounting,
pct_EXPO = percent
)
)
fig1<- plot_obs_2(df, feature, use_year = F)
fig2<- plot_obs_2(df, feature, use_year = T)
return(list(dt=dt, table=table, fig=fig1, figyr=fig2))
}
res<-resume(mrh_train, 'NB_PIECES')
res$dt
res$table
res$fig
res$figyr
resume <- function(df, feature) {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO ))
colnames(dt)[1] <- feature
table<- formattable(dt,
align = c("l", rep("r", NCOL(dt) - 1)),
list(
Freq = percent,
nb_lignes= accounting,
EXPO = accounting,
pct_EXPO = percent
)
)
fig1<- plot_obs_2(df, feature, use_year = F)
fig2<- plot_obs_2(df, feature, use_year = T)
return(list(dt=dt, table=table, fig=fig1, figyr=fig2))
}
resume <- function(df, feature) {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO ))
colnames(dt)[1] <- feature
table<- formattable(dt,
align = c("l", rep("r", NCOL(dt) - 1)),
list(
feature = formatter("span",
style = x ~ style(color = "gray"),
x ~ icontext(ifelse(x == "NA", "star", ""), x)),
Freq = percent,
nb_lignes= accounting,
EXPO = accounting,
pct_EXPO = percent
)
)
fig1<- plot_obs_2(df, feature, use_year = F)
fig2<- plot_obs_2(df, feature, use_year = T)
return(list(dt=dt, table=table, fig=fig1, figyr=fig2))
}
res<-resume(mrh_train, 'NB_PIECES')
res$dt
res$table
res$fig
res$figyr
resume <- function(df, feature) {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO ))
colnames(dt)[1] <- feature
table<- formattable(dt,
align = c("l", rep("r", NCOL(dt) - 1)),
list(
eval(feature) = formatter("span",
resume <- function(df, feature) {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO ))
colnames(dt)[1] <- feature
table<- formattable(dt,
align = c("l", rep("r", NCOL(dt) - 1)),
list(
eval(parse(feature)) = formatter("span",
resume <- function(df, feature) {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO ))
colnames(dt)[1] <- feature
table<- formattable(dt,
align = c("l", rep("r", NCOL(dt) - 1)),
list(
quote(feature)= formatter("span",
resume <- function(df, feature) {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO ))
colnames(dt)[1] <- feature
table<- formattable(dt,
align = c("l", rep("r", NCOL(dt) - 1)),
list(
Freq = percent,
nb_lignes= accounting,
EXPO = accounting,
pct_EXPO = percent
)
)
fig1<- plot_obs_2(df, feature, use_year = F)
fig2<- plot_obs_2(df, feature, use_year = T)
return(list(dt=dt, table=table, fig=fig1, figyr=fig2))
}
plot_obs_2<-function(df,feature,use_year=T) {
if (use_year) {
dt <-df %>%
group_by(df[[feature]], ANNEE, .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO)) %>%
rename(feat = 'df[[feature]]') %>%
replace_na(list(feat='empty'))
} else {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO)) %>%
rename(feat = 'df[[feature]]')
}
fig <-plot_ly()
fig <- fig %>% layout(title = paste0('Fréquence de sinistres par ', feature),
xaxis = list(title = feature),
yaxis = list(side = 'left', title = 'Exposition', showgrid = FALSE, zeroline = FALSE),
yaxis2 = list(side = 'right', overlaying = "y", title = 'Fréquence', showgrid = FALSE, zeroline = FALSE))
if (use_year) {
for (year in unique(dt$ANNEE)) {
dt_temp <- dt %>% filter(ANNEE==year)
fig <- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$EXPO, type = 'bar', name = paste0('Exposition_', year),
hovertemplate = 'Expo: %{y:.0f}<br>'
)
fig<- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$Freq, type = 'scatter', mode = 'lines', yaxis = 'y2', name= paste0('Fréquence_', year),
hovertemplate = 'Freq: %{y:.2%}<br>'
)
}
} else {
dt_temp <- dt
fig <- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$EXPO, type = 'bar', name = 'Exposition',
hovertemplate = 'Expo: %{y:.0f}<br>'
)
fig<- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$Freq, type = 'scatter', mode = 'lines', yaxis = 'y2', name= 'Fréquence',
hovertemplate = 'Freq: %{y:.2%}<br>'
)
}
return(fig)
}
res<-resume(mrh_train, 'NB_PIECES')
res$dt
res$table
res$fig
res$figyr
plot_obs_2<-function(df,feature,use_year=T) {
if (use_year) {
dt <-df %>%
group_by(df[[feature]], ANNEE, .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO)) %>%
rename(feat = 'df[[feature]]') %>%
replace_na(list(feat='NA'))
} else {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO)) %>%
rename(feat = 'df[[feature]]')
}
fig <-plot_ly()
fig <- fig %>% layout(title = paste0('Fréquence de sinistres par ', feature),
xaxis = list(title = feature),
yaxis = list(side = 'left', title = 'Exposition', showgrid = FALSE, zeroline = FALSE),
yaxis2 = list(side = 'right', overlaying = "y", title = 'Fréquence', showgrid = FALSE, zeroline = FALSE))
if (use_year) {
for (year in unique(dt$ANNEE)) {
dt_temp <- dt %>% filter(ANNEE==year)
fig <- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$EXPO, type = 'bar', name = paste0('Exposition_', year),
hovertemplate = 'Expo: %{y:.0f}<br>'
)
fig<- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$Freq, type = 'scatter', mode = 'lines', yaxis = 'y2', name= paste0('Fréquence_', year),
hovertemplate = 'Freq: %{y:.2%}<br>'
)
}
} else {
dt_temp <- dt
fig <- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$EXPO, type = 'bar', name = 'Exposition',
hovertemplate = 'Expo: %{y:.0f}<br>'
)
fig<- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$Freq, type = 'scatter', mode = 'lines', yaxis = 'y2', name= 'Fréquence',
hovertemplate = 'Freq: %{y:.2%}<br>'
)
}
return(fig)
}
res<-resume(mrh_train, 'NB_PIECES')
res$dt
res$table
res$fig
res$figyr
plot_obs_2<-function(df,feature,use_year=T) {
if (use_year) {
dt <-df %>%
group_by(df[[feature]], ANNEE, .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO)) %>%
rename(feat = 'df[[feature]]') %>%
replace_na(list(feat='NA'))
} else {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO)) %>%
rename(feat = 'df[[feature]]') %>%
replace_na(list(feat='NA'))
}
fig <-plot_ly()
fig <- fig %>% layout(title = paste0('Fréquence de sinistres par ', feature),
xaxis = list(title = feature),
yaxis = list(side = 'left', title = 'Exposition', showgrid = FALSE, zeroline = FALSE),
yaxis2 = list(side = 'right', overlaying = "y", title = 'Fréquence', showgrid = FALSE, zeroline = FALSE))
if (use_year) {
for (year in unique(dt$ANNEE)) {
dt_temp <- dt %>% filter(ANNEE==year)
fig <- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$EXPO, type = 'bar', name = paste0('Exposition_', year),
hovertemplate = 'Expo: %{y:.0f}<br>'
)
fig<- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$Freq, type = 'scatter', mode = 'lines', yaxis = 'y2', name= paste0('Fréquence_', year),
hovertemplate = 'Freq: %{y:.2%}<br>'
)
}
} else {
dt_temp <- dt
fig <- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$EXPO, type = 'bar', name = 'Exposition',
hovertemplate = 'Expo: %{y:.0f}<br>'
)
fig<- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$Freq, type = 'scatter', mode = 'lines', yaxis = 'y2', name= 'Fréquence',
hovertemplate = 'Freq: %{y:.2%}<br>'
)
}
return(fig)
}
res<-resume(mrh_train, 'VALEUR_DES_BIENS')
res$table
res$fig
res$figyr
plot_obs_2<-function(df,feature,use_year=T) {
if (use_year) {
dt <-df %>%
group_by(df[[feature]], ANNEE, .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO)) %>%
rename(feat = 'df[[feature]]')
} else {
dt <-df %>%
group_by(df[[feature]], .drop=FALSE) %>%
summarise(Freq = sum(NB*EXPO)/sum(EXPO), nb_lignes = n(), EXPO=sum(EXPO) ,  pct_EXPO = sum(EXPO) /  sum(df$EXPO)) %>%
rename(feat = 'df[[feature]]')
}
fig <-plot_ly()
fig <- fig %>% layout(title = paste0('Fréquence de sinistres par ', feature),
xaxis = list(title = feature),
yaxis = list(side = 'left', title = 'Exposition', showgrid = FALSE, zeroline = FALSE),
yaxis2 = list(side = 'right', overlaying = "y", title = 'Fréquence', showgrid = FALSE, zeroline = FALSE))
if (use_year) {
for (year in unique(dt$ANNEE)) {
dt_temp <- dt %>% filter(ANNEE==year)
fig <- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$EXPO, type = 'bar', name = paste0('Exposition_', year),
hovertemplate = 'Expo: %{y:.0f}<br>'
)
fig<- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$Freq, type = 'scatter', mode = 'lines', yaxis = 'y2', name= paste0('Fréquence_', year),
hovertemplate = 'Freq: %{y:.2%}<br>'
)
}
} else {
dt_temp <- dt
fig <- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$EXPO, type = 'bar', name = 'Exposition',
hovertemplate = 'Expo: %{y:.0f}<br>'
)
fig<- fig %>% add_trace(
x= dt_temp$feat, y= dt_temp$Freq, type = 'scatter', mode = 'lines', yaxis = 'y2', name= 'Fréquence',
hovertemplate = 'Freq: %{y:.2%}<br>'
)
}
return(fig)
}
res<-resume(mrh_train, 'VALEUR_DES_BIENS')
res$table
res$fig
res$figyr
tx <- sum(mrh_train$NB*mrh_train$EXPO)/sum(mrh_train$EXPO)
print('taux de sinistre moyen annuel : %{tx:.2%}')
tx <- sum(mrh_train$NB*mrh_train$EXPO)/sum(mrh_train$EXPO)
print(paste0('taux de sinistre moyen annuel : ', tx))
tx <- sum(mrh_train$NB*mrh_train$EXPO)/sum(mrh_train$EXPO)
print(paste0('taux de sinistre moyen annuel : ', round(tx * 100,2), '%')
tx <- sum(mrh_train$NB*mrh_train$EXPO)/sum(mrh_train$EXPO)
print(paste0('taux de sinistre moyen annuel : ', round(tx * 100,2), '%'))
df = mrh_train
feature = 'FORMULE'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'TYPE_RESIDENCE'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'TYPE_HABITATION'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'NB_PIECES'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'SITUATION_JURIDIQUE'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'NIVEAU_JURIDIQUE'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'VALEUR_DES_BIENS'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'OBJETS_DE_VALEUR'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'ZONIER'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'ZONIER'
test <- df %>% mutate(ZONIER2 = substr(ZONIER, 1,1)
df = mrh_train
feature = 'ZONIER'
test <- df %>% mutate(ZONIER2 = substr(ZONIER, 1,1))
View(test)
df = mrh_train
test <- df %>% mutate(ZONIER2 = substr(ZONIER, 1,1))
feature = 'ZONIER2'
res<-resume(test, feature)
res$table
res$fig
res$figyr
df = mrh_train
test <- df %>% mutate(REGION = substr(ZONIER, 1,1))
feature = 'REGION'
res<-resume(test, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'NBSIN_TYPE1_AN1'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'NBSIN_TYPE1_AN3'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'NBSIN_TYPE2_AN1'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'NBSIN_TYPE2_AN2'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'NBSIN_TYPE2_AN3'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'ANNEE'
res<-resume(df, feature)
res$table
res$fig
res$figyr
df = mrh_train
feature = 'ANNEE'
res<-resume(df, feature)
res$table
res$fig
df_train <- mrh_train %>%
select(-c('TYPE_HABITATION', 'NIVEAU_JURIDIQUE' ))
View(df_train)

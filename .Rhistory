hist(valid_prime_gbm, breaks = c((0:(201*max(valid_prime_gbm)))/200, 201/200*max(valid_prime_gbm)),xlim=c(0,.05),col=clrpal4[2],border="white",
main="",xlab="Primes estimées (GBM)",ylab="",ylim=c(0,37000))
hist(valid_prime_xgb, breaks = c((0:(201*max(valid_prime_xgb)))/200, 201/200*max(valid_prime_xgb)),xlim=c(0,.05),col=clrpal4[3],border="white",
main="",xlab="Primes estimées (XGB)",ylab="",ylim=c(0,37000))
dat = df_val
valid_prime_glm = fl_glm$predict_function(fit_glm, dat)
valid_prime_gbm = fl_gbm$predict_function(fit_gbm, dat)
valid_prime_xgb = fl_xgb$predict_function(fit_xgb, dat)
par(mfrow=c(1,3))
hist(valid_prime_glm, breaks = 100,xlim=c(0,.05),col=clrpal4[1],border="white",
main="",xlab="Primes estimées (GLM)",ylab="",ylim=c(0,10000))
hist(valid_prime_gbm, breaks = c((0:(201*max(valid_prime_gbm)))/200, 201/200*max(valid_prime_gbm)),xlim=c(0,.05),col=clrpal4[2],border="white",
main="",xlab="Primes estimées (GBM)",ylab="",ylim=c(0,37000))
hist(valid_prime_xgb, breaks = c((0:(201*max(valid_prime_xgb)))/200, 201/200*max(valid_prime_xgb)),xlim=c(0,.05),col=clrpal4[3],border="white",
main="",xlab="Primes estimées (XGB)",ylab="",ylim=c(0,37000))
dat = df_val
valid_prime_glm = fl_glm$predict_function(fit_glm, dat)
valid_prime_gbm = fl_gbm$predict_function(fit_gbm, dat)
valid_prime_xgb = fl_xgb$predict_function(fit_xgb, dat)
par(mfrow=c(1,3))
hist(valid_prime_glm, breaks = 100,xlim=c(0,.05),col=clrpal4[1],border="white",
main="",xlab="Primes estimées (GLM)",ylab="",ylim=c(0,4000))
hist(valid_prime_gbm, breaks = c((0:(201*max(valid_prime_gbm)))/200, 201/200*max(valid_prime_gbm)),xlim=c(0,.05),col=clrpal4[2],border="white",
main="",xlab="Primes estimées (GBM)",ylab="",ylim=c(0,37000))
hist(valid_prime_xgb, breaks = c((0:(201*max(valid_prime_xgb)))/200, 201/200*max(valid_prime_xgb)),xlim=c(0,.05),col=clrpal4[3],border="white",
main="",xlab="Primes estimées (XGB)",ylab="",ylim=c(0,37000))
dat = df_val
valid_prime_glm = fl_glm$predict_function(fit_glm, dat)
valid_prime_gbm = fl_gbm$predict_function(fit_gbm, dat)
valid_prime_xgb = fl_xgb$predict_function(fit_xgb, dat)
par(mfrow=c(1,3))
hist(valid_prime_glm, breaks = 100,xlim=c(0,.05),col=clrpal4[1],border="white",
main="",xlab="Primes estimées (GLM)",ylab="",ylim=c(0,4000))
hist(valid_prime_gbm, breaks = c((0:(201*max(valid_prime_gbm)))/200, 201/200*max(valid_prime_gbm)),xlim=c(0,.05),col=clrpal4[2],border="white",
main="",xlab="Primes estimées (GBM)",ylab="",ylim=c(0,4000))
hist(valid_prime_xgb, breaks = c((0:(201*max(valid_prime_xgb)))/200, 201/200*max(valid_prime_xgb)),xlim=c(0,.05),col=clrpal4[3],border="white",
main="",xlab="Primes estimées (XGB)",ylab="",ylim=c(0,4000))
dat = df_val
valid_prime_glm = fl_glm$predict_function(fit_glm, dat)
valid_prime_gbm = fl_gbm$predict_function(fit_gbm, dat)
valid_prime_xgb = fl_xgb$predict_function(fit_xgb, dat)
par(mfrow=c(1,3))
hist(valid_prime_glm, breaks = 100,xlim=c(0,.05),col=clrpal4[1],border="white",
main="",xlab="Primes estimées (GLM)",ylab="",ylim=c(0,4000))
hist(valid_prime_gbm, breaks = c((0:(101*max(valid_prime_gbm)))/100, 101/100*max(valid_prime_gbm)),xlim=c(0,.05),col=clrpal4[2],border="white",
main="",xlab="Primes estimées (GBM)",ylab="",ylim=c(0,4000))
hist(valid_prime_xgb, breaks = c((0:(201*max(valid_prime_xgb)))/200, 201/200*max(valid_prime_xgb)),xlim=c(0,.05),col=clrpal4[3],border="white",
main="",xlab="Primes estimées (XGB)",ylab="",ylim=c(0,4000))
dat = df_val
valid_prime_glm = fl_glm$predict_function(fit_glm, dat)
valid_prime_gbm = fl_gbm$predict_function(fit_gbm, dat)
valid_prime_xgb = fl_xgb$predict_function(fit_xgb, dat)
par(mfrow=c(1,3))
hist(valid_prime_glm, breaks = 100,xlim=c(0,.05),col=clrpal4[1],border="white",
main="",xlab="Primes estimées (GLM)",ylab="",ylim=c(0,4000))
hist(valid_prime_gbm, breaks = 100,xlim=c(0,.05),col=clrpal4[2],border="white",
main="",xlab="Primes estimées (GBM)",ylab="",ylim=c(0,4000))
hist(valid_prime_xgb, breaks = c((0:(201*max(valid_prime_xgb)))/200, 201/200*max(valid_prime_xgb)),xlim=c(0,.05),col=clrpal4[3],border="white",
main="",xlab="Primes estimées (XGB)",ylab="",ylim=c(0,4000))
dat = df_val
valid_prime_glm = fl_glm$predict_function(fit_glm, dat)
valid_prime_gbm = fl_gbm$predict_function(fit_gbm, dat)
valid_prime_xgb = fl_xgb$predict_function(fit_xgb, dat)
par(mfrow=c(1,3))
hist(valid_prime_glm, breaks = 100,xlim=c(0,.05),col=clrpal4[1],border="white",
main="",xlab="Primes estimées (GLM)",ylab="",ylim=c(0,4000))
hist(valid_prime_gbm, breaks = 100,xlim=c(0,.05),col=clrpal4[2],border="white",
main="",xlab="Primes estimées (GBM)",ylab="",ylim=c(0,4000))
hist(valid_prime_xgb, breaks = 100,xlim=c(0,.05),col=clrpal4[3],border="white",
main="",xlab="Primes estimées (XGB)",ylab="",ylim=c(0,4000))
dat = df_val
valid_prime_glm = fl_glm$predict_function(fit_glm, dat)
valid_prime_gbm = fl_gbm$predict_function(fit_gbm, dat)
valid_prime_xgb = fl_xgb$predict_function(fit_xgb, dat)
par(mfrow=c(1,3))
hist(valid_prime_glm, breaks = 100,xlim=c(0,.06),col=clrpal4[1],border="white",
main="",xlab="Primes estimées (GLM)",ylab="",ylim=c(0,3000))
hist(valid_prime_gbm, breaks = 100,xlim=c(0,.06),col=clrpal4[2],border="white",
main="",xlab="Primes estimées (GBM)",ylab="",ylim=c(0,3000))
hist(valid_prime_xgb, breaks = 100,xlim=c(0,.06),col=clrpal4[3],border="white",
main="",xlab="Primes estimées (XGB)",ylab="",ylim=c(0,3000))
dat = df_val
valid_prime_glm = fl_glm$predict_function(fit_glm, dat)
valid_prime_gbm = fl_gbm$predict_function(fit_gbm, dat)
valid_prime_xgb = fl_xgb$predict_function(fit_xgb, dat)
par(mfrow=c(1,3))
hist(valid_prime_glm, breaks = 100,xlim=c(0,.08),col=clrpal4[1],border="white",
main="",xlab="Primes estimées (GLM)",ylab="",ylim=c(0,3000))
hist(valid_prime_gbm, breaks = 100,xlim=c(0,.08),col=clrpal4[2],border="white",
main="",xlab="Primes estimées (GBM)",ylab="",ylim=c(0,3000))
hist(valid_prime_xgb, breaks = 100,xlim=c(0,.08),col=clrpal4[3],border="white",
main="",xlab="Primes estimées (XGB)",ylab="",ylim=c(0,3000))
dat = df_test
valid_prime_glm = fl_glm$predict_function(fit_glm, dat)
valid_prime_gbm = fl_gbm$predict_function(fit_gbm, dat)
valid_prime_xgb = fl_xgb$predict_function(fit_xgb, dat)
par(mfrow=c(1,3))
hist(valid_prime_glm, breaks = 100,xlim=c(0,.08),col=clrpal4[1],border="white",
main="",xlab="Primes estimées (GLM)",ylab="",ylim=c(0,3000))
hist(valid_prime_gbm, breaks = 100,xlim=c(0,.08),col=clrpal4[2],border="white",
main="",xlab="Primes estimées (GBM)",ylab="",ylim=c(0,3000))
hist(valid_prime_xgb, breaks = 100,xlim=c(0,.08),col=clrpal4[3],border="white",
main="",xlab="Primes estimées (XGB)",ylab="",ylim=c(0,3000))
dat = df_test
test_prime_glm = fl_glm$predict_function(fit_glm, dat)
test_prime_gbm = fl_gbm$predict_function(fit_gbm, dat)
test_prime_xgb = fl_xgb$predict_function(fit_xgb, dat)
fit_loc_glm = locfit.raw(x=valid_prime_glm,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
if (!require("here")){
install.packages("here")
library("here")
}
set_here
LoadPackage <- function (load.lib=c("")) {
install.lib<-load.lib[!load.lib %in% installed.packages()]
for(lib in install.lib) install.packages(lib,dependencies=TRUE)
sapply(load.lib,require,character=TRUE)
}
LoadPackage(c('ggplot2', 'dplyr', 'formattable', 'DT', 'tidyr', 'caret', 'plotly', 'xgboost', 'flashlight', 'MetricsWeighted', 'corrplot', 'lsr', 'h2o', 'wesanderson', 'locfit'))
dat = df_test
test_prime_glm = fl_glm$predict_function(fit_glm, dat)
test_prime_gbm = fl_gbm$predict_function(fit_gbm, dat)
test_prime_xgb = fl_xgb$predict_function(fit_xgb, dat)
fit_loc_glm = locfit.raw(x=valid_prime_glm,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
fit_loc_gbm = locfit.raw(x=valid_prime_gbm,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
fit_loc_xgb = locfit.raw(x=valid_prime_xgb,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
plot(fit_loc_glm,lwd=3,col=clrpal4[1],xlim=c(0,.2),xlab="Premium (GLM)",ylab="",ylim=c(0,.2))
abline(a=0,b=1,lwd=.4)
dat = df_val
valid_prime_glm = fl_glm$predict_function(fit_glm, dat)
valid_prime_gbm = fl_gbm$predict_function(fit_gbm, dat)
valid_prime_xgb = fl_xgb$predict_function(fit_xgb, dat)
fit_loc_glm = locfit.raw(x=valid_prime_glm,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
fit_loc_gbm = locfit.raw(x=valid_prime_gbm,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
fit_loc_xgb = locfit.raw(x=valid_prime_xgb,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
plot(fit_loc_glm,lwd=3,col=clrpal4[1],xlim=c(0,.2),xlab="Premium (GLM)",ylab="",ylim=c(0,.2))
abline(a=0,b=1,lwd=.4)
par(mfrow=c(1,3))
plot(fit_loc_glm,lwd=3,col=clrpal4[1],xlim=c(0,.2),xlab="Primes estimées (GLM)",ylab="",ylim=c(0,.2))
abline(a=0,b=1,lwd=.4)
plot(fit_loc_gbm,lwd=3,col=clrpal4[2],xlim=c(0,.2),xlab="Primes estimées (GBM)",ylab="",ylim=c(0,.2))
abline(a=0,b=1,lwd=.4)
plot(fit_loc_xgb,lwd=3,col=clrpal4[3],xlim=c(0,.2),xlab="Primes estimées (XGB)",ylab="",ylim=c(0,.2))
abline(a=0,b=1,lwd=.4)
par(mfrow=c(1,3))
plot(fit_loc_glm,lwd=3,col=clrpal4[1],xlim=c(0,.08),xlab="Primes estimées (GLM)",ylab="",ylim=c(0,.08))
abline(a=0,b=1,lwd=.4)
plot(fit_loc_gbm,lwd=3,col=clrpal4[2],xlim=c(0,.08),xlab="Primes estimées (GBM)",ylab="",ylim=c(0,.08))
abline(a=0,b=1,lwd=.4)
plot(fit_loc_xgb,lwd=3,col=clrpal4[3],xlim=c(0,.08),xlab="Primes estimées (XGB)",ylab="",ylim=c(0,.08))
abline(a=0,b=1,lwd=.4)
dat = df_val
# print (paste0('fréquence de référence sur le jeu de données : ', sum(dat$NB)/sum(dat$EXPO)))
# print (paste0('fréquence estimée par le GLM sur le jeu de données : ', sum(fl_glm$predict_function(fit_glm, dat))/sum(dat$EXPO)))
# print (paste0('fréquence estimée par le GBM sur le jeu de données : ', sum(fl_gbm$predict_function(fit_gbm, dat))/sum(dat$EXPO)))
# print (paste0('fréquence estimée par le XGB sur le jeu de données : ', sum(fl_xgb$predict_function(fit_xgb, dat))/sum(dat$EXPO)))
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
sum(fl_glm$predict_function(fit_glm, dat))/sum(dat$EXPO),
sum(fl_gbm$predict_function(fit_gbm, dat))/sum(dat$EXPO),
sum(fl_xgb$predict_function(fit_xgb, dat))/sum(dat$EXPO)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1 ) %>%
mutate(PctECART = sprintf("%.1f %%", 100*PctECART) )
ref
p_glm = predict(fit_loc_glm,newdata = valid_prime_glm)
p_gbm = predict(fit_loc_gbm,newdata = valid_prime_gbm)
p_xgb = predict(fit_loc_xgb,newdata = valid_prime_xgb)
valid_prime_glm_bc = valid_prime_glm * (p_glm/valid_prime_glm)
valid_prime_gbm_bc = valid_prime_gbm * (p_gbm/valid_prime_gbm)
valid_prime_xgb_bc = valid_prime_xgb * (p_xgb/valid_prime_xgb)
fit_loc_glm_bc = locfit.raw(x=valid_prime_glm_bc,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
fit_loc_gbm_bc = locfit.raw(x=valid_prime_gbm_bc,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
fit_loc_xgb_bc = locfit.raw(x=valid_prime_xgb_bc,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
par(mfrow=c(1,3))
plot(fit_loc_glm_bc,lwd=3,col=clrpal4[1],xlim=c(0,.08),xlab="Primes estimées équilibrées (GLM)",ylab="",ylim=c(0,.08))
lines(fit_loc_glm,col=scales::alpha(clrpal4[1],.4))
abline(a=0,b=1,lwd=.4)
plot(fit_loc_gbm_bc,lwd=3,col=clrpal4[2],xlim=c(0,.08),xlab="Primes estimées équilibrées (GBM)",ylab="",ylim=c(0,.08))
lines(fit_loc_gbm,col=scales::alpha(clrpal4[2],.4))
abline(a=0,b=1,lwd=.4)
plot(fit_loc_xgb_bc,lwd=3,col=clrpal4[3],xlim=c(0,.08),xlab="Primes estimées équilibrées (XGB)",ylab="",ylim=c(0,.08))
lines(fit_loc_xgb,col=scales::alpha(clrpal4[3],.4))
abline(a=0,b=1,lwd=.4)
par(mfrow=c(1,3))
plot(fit_loc_glm_bc,lwd=3,col=clrpal4[1],xlim=c(0,.08),xlab="Primes estimées équilibrées (GLM)",ylab="",ylim=c(0,.08))
lines(fit_loc_glm,col=scales::alpha(clrpal4[1],.4))
abline(a=0,b=1,lwd=.4)
plot(fit_loc_gbm_bc,lwd=3,col=clrpal4[2],xlim=c(0,.08),xlab="Primes estimées équilibrées (GBM)",ylab="",ylim=c(0,.08))
lines(fit_loc_gbm,col=scales::alpha(clrpal4[2],.4))
abline(a=0,b=1,lwd=.4)
plot(fit_loc_xgb_bc,lwd=3,col=clrpal4[3],xlim=c(0,.08),xlab="Primes estimées équilibrées (XGB)",ylab="",ylim=c(0,.08))
lines(fit_loc_xgb,col=scales::alpha(clrpal4[3],.4))
abline(a=0,b=1,lwd=.4)
dat = df_val
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm)/sum(dat$EXPO),
sum(valid_prime_gbm)/sum(dat$EXPO),
sum(valid_prime_xgb)/sum(dat$EXPO)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1 ) %>%
mutate(PctECART = sprintf("%.1f %%", 100*PctECART) )
ref
dat = df_val
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm)/sum(dat$EXPO),
sum(valid_prime_gbm)/sum(dat$EXPO),
sum(valid_prime_xgb)/sum(dat$EXPO)
)
ref$primesmoy_eq = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm_bc)/sum(dat$EXPO),
sum(valid_prime_gbm_bc)/sum(dat$EXPO),
sum(valid_prime_xgb_bc)/sum(dat$EXPO)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1,
PctECART_eq = primesmoy_eq/ (sum(dat$NB)/sum(dat$EXPO)) -1
) %>%
mutate(
PctECART = sprintf("%.1f %%", 100*PctECART),
PctECART_eq = sprintf("%.1f %%", 100*PctECART_eq)
)
ref
dat = df_val
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm)/sum(dat$EXPO),
sum(valid_prime_gbm)/sum(dat$EXPO),
sum(valid_prime_xgb)/sum(dat$EXPO)
)
ref$primesmoy_eq = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm_bc),
sum(valid_prime_gbm_bc),
sum(valid_prime_xgb_bc)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1,
PctECART_eq = primesmoy_eq/ (sum(dat$NB)/sum(dat$EXPO)) -1
) %>%
mutate(
PctECART = sprintf("%.1f %%", 100*PctECART),
PctECART_eq = sprintf("%.1f %%", 100*PctECART_eq)
)
ref
dat = df_val
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm)/sum(dat$EXPO),
sum(valid_prime_gbm)/sum(dat$EXPO),
sum(valid_prime_xgb)/sum(dat$EXPO)
)
ref$primesmoy_eq = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm_bc)/sum(dat$EXPO),
sum(valid_prime_gbm_bc)/sum(dat$EXPO),
sum(valid_prime_xgb_bc)/sum(dat$EXPO)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1,
PctECART_eq = primesmoy_eq/ (sum(dat$NB)/sum(dat$EXPO)) -1
) %>%
mutate(
PctECART = sprintf("%.1f %%", 100*PctECART),
PctECART_eq = sprintf("%.1f %%", 100*PctECART_eq)
)
ref
dat = df_val
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm)/sum(dat$EXPO),
sum(valid_prime_gbm)/sum(dat$EXPO),
sum(valid_prime_xgb)/sum(dat$EXPO)
)
ref$primesmoy_eq = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm_bc)/sum(dat$EXPO),
sum(valid_prime_gbm_bc)/sum(dat$EXPO),
sum(valid_prime_xgb_bc)/sum(dat$EXPO)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1,
PctECART_eq = primesmoy_eq/ (sum(dat$NB)/sum(dat$EXPO)) -1
) %>%
mutate(
PctECART = sprintf("%.1f %%", 100*PctECART),
PctECART_eq = sprintf("%.1f %%", 100*PctECART_eq)
) %>%
arrange(modeles, primesmoy, PcyECART, primesmoy_eq, PctECART_eq)
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm)/sum(dat$EXPO),
sum(valid_prime_gbm)/sum(dat$EXPO),
sum(valid_prime_xgb)/sum(dat$EXPO)
)
ref$primesmoy_eq = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm_bc)/sum(dat$EXPO),
sum(valid_prime_gbm_bc)/sum(dat$EXPO),
sum(valid_prime_xgb_bc)/sum(dat$EXPO)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1,
PctECART_eq = primesmoy_eq/ (sum(dat$NB)/sum(dat$EXPO)) -1
) %>%
mutate(
PctECART = sprintf("%.1f %%", 100*PctECART),
PctECART_eq = sprintf("%.1f %%", 100*PctECART_eq)
) %>%
arrange(modeles, primesmoy, PctECART, primesmoy_eq, PctECART_eq)
ref
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm)/sum(dat$EXPO),
sum(valid_prime_gbm)/sum(dat$EXPO),
sum(valid_prime_xgb)/sum(dat$EXPO)
)
ref$primesmoy_eq = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm_bc)/sum(dat$EXPO),
sum(valid_prime_gbm_bc)/sum(dat$EXPO),
sum(valid_prime_xgb_bc)/sum(dat$EXPO)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1,
PctECART_eq = primesmoy_eq/ (sum(dat$NB)/sum(dat$EXPO)) -1
) %>%
mutate(
PctECART = sprintf("%.1f %%", 100*PctECART),
PctECART_eq = sprintf("%.1f %%", 100*PctECART_eq)
) %>%
relocate(modeles, primesmoy, PctECART, primesmoy_eq, PctECART_eq)
ref
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
mean(valid_prime_glm),
mean(valid_prime_gbm),
mean(valid_prime_xgb)
)
ref$primesmoy_eq = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm_bc)/sum(dat$EXPO),
sum(valid_prime_gbm_bc)/sum(dat$EXPO),
sum(valid_prime_xgb_bc)/sum(dat$EXPO)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1,
PctECART_eq = primesmoy_eq/ (sum(dat$NB)/sum(dat$EXPO)) -1
) %>%
mutate(
PctECART = sprintf("%.1f %%", 100*PctECART),
PctECART_eq = sprintf("%.1f %%", 100*PctECART_eq)
) %>%
relocate(modeles, primesmoy, PctECART, primesmoy_eq, PctECART_eq)
ref
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
mean(valid_prime_glm),
mean(valid_prime_gbm),
mean(valid_prime_xgb)
)
ref$primesmoy_eq = c(sum(dat$NB)/sum(dat$EXPO),
mean(valid_prime_glm_bc),#/sum(dat$EXPO),
mean(valid_prime_gbm_bc),#/sum(dat$EXPO),
mean(valid_prime_xgb_bc)#/sum(dat$EXPO)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1,
PctECART_eq = primesmoy_eq/ (sum(dat$NB)/sum(dat$EXPO)) -1
) %>%
mutate(
PctECART = sprintf("%.1f %%", 100*PctECART),
PctECART_eq = sprintf("%.1f %%", 100*PctECART_eq)
) %>%
relocate(modeles, primesmoy, PctECART, primesmoy_eq, PctECART_eq)
ref
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm)/sum(dat$EXPO),
sum(valid_prime_gbm)/sum(dat$EXPO),
sum(valid_prime_xgb)/sum(dat$EXPO)
)
ref$primesmoy_eq = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm_bc)/sum(dat$EXPO),
sum(valid_prime_gbm_bc)/sum(dat$EXPO),
sum(valid_prime_xgb_bc)/sum(dat$EXPO)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1,
PctECART_eq = primesmoy_eq/ (sum(dat$NB)/sum(dat$EXPO)) -1
) %>%
mutate(
PctECART = sprintf("%.1f %%", 100*PctECART),
PctECART_eq = sprintf("%.1f %%", 100*PctECART_eq)
) %>%
relocate(modeles, primesmoy, PctECART, primesmoy_eq, PctECART_eq)
ref
dat <- df_val
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm)/sum(dat$EXPO),
sum(valid_prime_gbm)/sum(dat$EXPO),
sum(valid_prime_xgb)/sum(dat$EXPO)
)
ref$primesmoy_eq = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm_bc)/sum(dat$EXPO),
sum(valid_prime_gbm_bc)/sum(dat$EXPO),
sum(valid_prime_xgb_bc)/sum(dat$EXPO)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1,
PctECART_eq = primesmoy_eq/ (sum(dat$NB)/sum(dat$EXPO)) -1
) %>%
mutate(
PctECART = sprintf("%.1f %%", 100*PctECART),
PctECART_eq = sprintf("%.1f %%", 100*PctECART_eq)
) %>%
relocate(modeles, primesmoy, PctECART, primesmoy_eq, PctECART_eq)
ref
summary(valid_prime_xgb_bc)
p_glm = predict(fit_loc_glm, newdata = valid_prime_glm)
p_gbm = predict(fit_loc_gbm, newdata = valid_prime_gbm)
p_xgb = predict(fit_loc_xgb, newdata = valid_prime_xgb)
valid_prime_glm_bc = p_glm
valid_prime_gbm_bc = p_gbm
valid_prime_xgb_bc = p_xgb
fit_loc_glm_bc = locfit.raw(x=valid_prime_glm_bc,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
fit_loc_gbm_bc = locfit.raw(x=valid_prime_gbm_bc,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
fit_loc_xgb_bc = locfit.raw(x=valid_prime_xgb_bc,
y=df_val[,"Y"],
weights=df_val[,"EXPO"],
kern="rect",deg=0,alpha=.05)
View(fit_loc_glm)
dat <- df_val
ref <- data.frame(modeles=c('référence', 'GLM', 'GBM', 'XGB'))
ref$primesmoy = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm)/sum(dat$EXPO),
sum(valid_prime_gbm)/sum(dat$EXPO),
sum(valid_prime_xgb)/sum(dat$EXPO)
)
ref$primesmoy_eq = c(sum(dat$NB)/sum(dat$EXPO),
sum(valid_prime_glm_bc)/sum(dat$EXPO),
sum(valid_prime_gbm_bc)/sum(dat$EXPO),
sum(valid_prime_xgb_bc)/sum(dat$EXPO)
)
ref <- ref%>%
mutate(PctECART = primesmoy/ (sum(dat$NB)/sum(dat$EXPO)) -1,
PctECART_eq = primesmoy_eq/ (sum(dat$NB)/sum(dat$EXPO)) -1
) %>%
mutate(
PctECART = sprintf("%.1f %%", 100*PctECART),
PctECART_eq = sprintf("%.1f %%", 100*PctECART_eq)
) %>%
relocate(modeles, primesmoy, PctECART, primesmoy_eq, PctECART_eq)
ref
par(mfrow=c(1,3))
plot(cbind(valid_prime_glm, df_val$Y),lwd=3,col=clrpal4[1],xlim=c(0,.08),xlab="Primes estimées (GLM)",ylab="",ylim=c(0,.08))
abline(a=0,b=1,lwd=.4)
plot(fit_loc_gbm,lwd=3,col=clrpal4[2],xlim=c(0,.08),xlab="Primes estimées (GBM)",ylab="",ylim=c(0,.08))
abline(a=0,b=1,lwd=.4)
plot(fit_loc_xgb,lwd=3,col=clrpal4[3],xlim=c(0,.08),xlab="Primes estimées (XGB)",ylab="",ylim=c(0,.08))
abline(a=0,b=1,lwd=.4)
summary(df_val$Y)
summary(valid_prime_glm)
summary(df_val$Y)
summary(valid_prime_glm/df_val$EXPO)
summary(df_val$Y)
summary(valid_prime_glm*df_val$EXPO)
summary(df_val$Y)
summary(valid_prime_glm/df_val$EXPO)
summary(df_val$Y)
summary(valid_prime_glm)
summary(df_val$NB)
summary(valid_prime_glm)
summary(df_val$NB:df_val$EXPO)
summary(valid_prime_glm)
summary(df_val$NB/df_val$EXPO)
summary(valid_prime_glm)
